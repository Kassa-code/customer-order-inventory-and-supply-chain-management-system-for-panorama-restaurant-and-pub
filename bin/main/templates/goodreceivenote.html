<!DOCTYPE html>
<html lang="en">
<!-- Insert CSS and head JS here -->

<head th:replace="~{fragmentlinks :: headResourcesLinks}"></head>

<head>
    <!-- Custom CSS files -->
    <link rel="stylesheet" href="/css/employee.css">
    <link rel="stylesheet" href="/css/dashboard.css">

</head>

<body>

    <!-- Bootstrap Navigation Bar Start-->
    <div th:replace="~{topnavbar :: topNavBarFragment}"></div>
    <!-- Bootstrap Navigation Bar End-->

    <div class="container-fluid">
        <!-- ======================= Page Header Row ======================= -->
        <!-- Row Start: Page Header -->
        <div class="row mt-2">
            <div class="col-12 fw-bold header p-2">
                <h2><i class="fa-solid fa-clipboard-list"></i> Good Receive Note Management</h2>
            </div>
        </div><br>
        <!-- Row End: Page Header -->

        <!-- ======================= Add Button Section ======================= -->
        <!-- Row Start: Add New Item Button -->
        <div class="card p-3">
            <!-- Row Start: Button and Tooltip -->
            <div class="row">
                <div class="col-12 text-end">
                    <!-- Triggers the offcanvas form -->
                    <button type="button" class="btn offcanvas-btn fw-bold" data-bs-toggle="offcanvas"
                        data-bs-target="#offcanvasGrnForm">
                        <i class="fa-solid fa-plus"></i> ADD A NEW GRN
                    </button>
                    <small class="text-muted d-block mt-2">Click this to add a new good receive note</small>
                </div>
            </div>
            <!-- Row End: Button and Tooltip -->
        </div>
        <!-- Row End: Add New Item Button -->

        <!-- ======================= Table Display Section ======================= -->
        <!-- Row Start: Data Table -->
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-body">
                        <table class="table table-hover table-striped table-container" id="tableGrn">
                            <thead class="custom-thead fw-bold">
                                <tr>
                                    <!-- Table Headers -->
                                    <th>#</th>
                                    <th>Order Code</th>
                                    <th>Supplier Name</th>
                                    <th>Delivered Date</th>
                                    <th>Bill No</th>
                                    <th>Total Amount (Rs.)</th>
                                    <th>Net Amount (Rs.)</th>
                                    <th>Status</th>
                                    <th>Modify</th>
                                </tr>
                            </thead>
                            <!-- Table Body: Filled dynamically via JS -->
                            <tbody class="custom-tbody fw-bold" id="tableGrnBody">
                                <!-- Item rows dynamically inserted here -->
                            </tbody>
                        </table>
                    </div>

                    <!-- Ingredient Status Icons Explanation (Inside the Card Footer) -->
                    <div class="card-footer text-center">
                        <!-- &nbsp; adds space, | is a separator, and another &nbsp; ensures spacing on both sides -->
                        <i class="fa-solid fa-clipboard-list fa-lg text-warning"></i> <span class="ms-2">Received</span>
                        &nbsp;
                        <i class="fa-solid fa-clipboard-list fa-lg text-primary"></i> <span class="ms-2">Partially Completed</span>
                        &nbsp;
                        <i class="fa-solid fa-clipboard-list fa-lg text-success"></i> <span class="ms-2">Completed</span>
                        
                    </div>
                </div>
            </div>
        </div>
        <!-- Row End: Data Table -->

    </div>


    <!-- ======================= Offcanvas Main Form / Inner Form======================= -->

    
    <div class="offcanvas offcanvas-end" style="width: 100%;" tabindex="-1" id="offcanvasGrnForm"
        role="dialog">

        <!-- Bootstrap Navigation Bar Start-->
        <nav th:replace="topnavbar :: topNavBarFragment"></nav>
        <!-- Bootstrap Navigation Bar End-->


        <div class="offcanvas-header">
            <h5 class="offcanvas-title text-center w-100"><i class="fa-solid fa-clipboard-list"></i> Good Receive Note Details</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>

        <div class="offcanvas-body">
            
            <div class="card">
                <div class="card-body">
                    <!-- Purchase Order Form -->
                    <form id="formgrn" onsubmit="return false">
                        <!-- ======================= Required Note Row ======================= -->
                        <div class="row mt-2">
                            <div class="col-12 fw-bold mt-2">
                                <p class="text-end">Required <span class="text-danger">*</span></p>
                            </div>
                        </div>


                        <div class="row mt-2">
                            <!-- ======================= Main Form ======================= -->
                            <div class="col-5">
                                <!-- Select Supplier -->
                                <div class="row mt-2">
                                    <div class="col-3 fw-bold">
                                        <label for="selectSupplier" class="form-label fw-bold">Supplier : <span class="text-danger">*</span></label>
                                    </div>
                                    <div class="col-9">
                                        <select name="selectSupplier" required id="selectSupplier" class="form-select"
                                            onchange="selectDynamicElementValidator(this,'goodReceiveNote','supplier_id');filterItemsBySupplier();filterPurchaseOrdersBySupplier();">
                                        </select>
                                    </div>
                                </div>
                                <!-- Select Purchase Order -->
                                <div class="row mt-2">
                                    <div class="col-3 fw-bold">
                                        <label for="selectPurchaseOrder" class="form-label fw-bold">Purchase Order : </label>
                                    </div>
                                    <div class="col-9">
                                        <select name="selectPurchaseOrder" id="selectPurchaseOrder" class="form-select"
                                            onchange="selectDynamicElementValidator(this,'goodReceiveNote','supplierpurchaseorder_id')">
                                        </select>
                                    </div>
                                </div>

                                <!-- Select Required Date -->
                                <div class="row mt-2">
                                    <div class="col-3 fw-bold">
                                        <label for="dteReceiptDate" class="form-label">Receipt <br> Date : <span class="text-danger">*</span></label>
                                    </div>
                                    <div class="col-9">
                                        <input onkeydown="return false"
                                            onchange="dateElementValidator(this,'goodReceiveNote','date_of_receipt')"
                                            type="date" id="dteReceiptDate" required class="form-control"
                                            name="dteReceiptDate" placeholder="Enter Receipt Date">
                                    </div>
                                </div>

                                <!-- Enter Bill No -->
                                <div class="row mt-2">
                                    <div class="col-3 fw-bold">
                                        <label for="textBillNo" class="form-label">Bill No : <span class="text-danger">*</span></label>
                                    </div>
                                    <div class="col-9">
                                        <input
                                        onkeyup="commonTextValidator(this,'^[A-Za-z0-9]{5,20}$','goodReceiveNote','supplier_bill_no')"
                                            type="text" id="textBillNo" required class="form-control"
                                            name="textBillNo" placeholder="Enter Bill No">
                                    </div>
                                </div>

                                <!-- Enter Total Amount -->
                                <div class="row mt-2">
                                    <div class="col-3 fw-bold">
                                        <label for="textTotalAmount" class="form-label fw-bold">Total <br> Amount :
                                        <span class="text-danger">*</span></label>
                                    </div>
                                    <div class="col-9">
                                        <input type="text" class="form-control" id="textTotalAmount"
                                            placeholder="Enter Total Amount"
                                            onkeyup="commonTextValidator(this,'^(([1-9][0-9]{0,3})|([1-9][0-9]{0,3}[.]{0,1}[0-9]{2}))$','goodReceiveNote','total_amount')"
                                            required>
                                    </div>
                                </div>
                                <!-- Enter Discount Amount -->
                                <div class="row mt-2">
                                    <div class="col-3 fw-bold">
                                        <label for="textDiscountAmount" class="form-label fw-bold">Discount <br> Amount : </label>
                                    </div>
                                    <div class="col-9">
                                        <input type="text" class="form-control" id="textDiscountAmount"
                                            placeholder="Enter Discount Amount"
                                            onkeyup="commonTextValidator(this,'^(([0-9][0-9]{0,3})|([0-9][0-9]{0,3}[.]{0,1}[0-9]{2}))$','goodReceiveNote','discount_amount');calculateNetAmount();">
                                    </div>
                                </div>

                                <!-- Enter Net Amount -->
                                <div class="row mt-2">
                                    <div class="col-3 fw-bold">
                                        <label for="textNetAmount" class="form-label fw-bold">Net <br> Amount :
                                        <span class="text-danger">*</span></label>
                                    </div>
                                    <div class="col-9">
                                        <input type="text" class="form-control" id="textNetAmount"
                                            placeholder="Enter Net Amount"
                                            onkeyup="commonTextValidator(this,'^(([1-9][0-9]{0,3})|([1-9][0-9]{0,3}[.]{0,1}[0-9]{2}))$','goodReceiveNote','net_amount');"
                                            required>
                                    </div>
                                </div>

                                
                                <!-- Order Status -->
                                <div class="row mt-2">
                                    <div class="col-3 fw-bold">
                                        <label for="selectGrnStatus" class="form-label fw-bold">GRN <br> Status : <span class="text-danger">*
                                        </span></label>
                                    </div>
                                    <div class="col-9">
                                        <select name="selectGrnStatus" required id="selectGrnStatus"
                                            class="form-select"
                                            onchange="selectDynamicElementValidator(this,'goodReceiveNote','grn_status_id')">
                                        </select>
                                    </div>
                                </div>

                                <!-- Enter Note -->
                                <div class="row mt-2">
                                    <div class="col-3 fw-bold">
                                        <label for="textNote" class="form-label fw-bold">Note :</label>
                                    </div>
                                    <div class="col-9">
                                        <textarea class="form-control" id="textNote" placeholder="Enter Note"
                                            onkeyup="commonTextValidator(this,'^([A-Za-z0-9\/]{1,20}[.]?[\s]?)+$','goodReceiveNote','note')"></textarea>
                                    </div>
                                </div>

                            </div>

                            <!-- ======================= Inner Form / Table ================ -->
                            <div class="col-7">
                                <!-- Card Wrapper -->
                                <div class="card shadow-sm">
                                    <div class="card-body">
                                        <h5 class="card-title fw-bold text-center">Good Receive Note Item</h5> <br>
                                        <div class="row mt-1">

                                            <!-- Item -->
                                            <div class="col-8">
                                                <label for="selectItem" class="form-label fw-bold">Item : <span class="text-danger">*</span></label>
                                                <select name="selectItem" id="selectItem" class="form-select"
                                                    onchange="selectDynamicElementValidator(this,'goodReceiveNoteHasItem','ingredients_id');checkItemExt();">
                                                </select>
                                            </div>

                                            <!-- Quantity -->
                                            <div class="col-4">
                                                <label for="textQuantity" class="form-label fw-bold">Quantity :
                                                    <span class="text-danger">*</span></label>
                                                <input type="text" class="form-control" id="textQuantity" placeholder="Enter Quantity"
                                                    onkeyup="commonTextValidator(this,'^([1-9][0-9]{0,3})$','goodReceiveNoteHasItem','grn_quantity');calculateLinePrice();">
                                            </div>
                                        </div>
                                        <div class="row mt-1">

                                            <!-- Purchase Price -->
                                            <div class="col-8">
                                                <label for="textPurchasePrice" class="form-label fw-bold">Purchase Price : <span class="text-danger">*</span></label>
                                                <input type="text" class="form-control" id="textPurchasePrice" placeholder="Enter Purchase Price" onkeyup="commonTextValidator(this,'^(([1-9][0-9]{0,10})|([1-9][0-9]{0,10}[.]{0,1}[0-9]{2}))$','goodReceiveNoteHasItem','purchase_price')">
                                            </div>

                                            <!-- Line Price -->
                                            <div class="col-4">
                                                <label for="textLinePrice" class="form-label fw-bold">Line Price
                                                    : <span class="text-danger">*</span></label>
                                                <input type="text" class="form-control" id="textLinePrice"
                                                    placeholder="Enter Line Price"
                                                    onkeyup="commonTextValidator(this,'^(([1-9][0-9]{0,10})|([1-9][0-9]{0,10}[.]{0,1}[0-9]{2}))$','goodReceiveNoteHasItem','line_price')">
                                            </div>
                                        </div>
                                        <div class="row mt-1">

                                            <!-- Batch No -->
                                            <div class="col">
                                                <label for="textBatchNo" class="form-label fw-bold">Batch No : </label>
                                                <input type="text" class="form-control" id="textBatchNo" placeholder="Enter Batch No" onkeyup="commonTextValidator(this,'^[A-Za-z0-9]{5,20}$','goodReceiveNoteHasItem','batchno')">
                                            </div>

                                            <!-- Manufacture Date Date -->
                                            <div class="col">
                                                <label for="dteMfdDate" class="form-label fw-bold">MFD : </label>
                                                <input onkeydown="return false" onchange="dateElementValidator(this,'goodReceiveNoteHasItem','mfcdate')" type="date"
                                                id="dteMfdDate" required class="form-control" name="dteMfdDate">
                                            </div>

                                            <!-- Expire Date -->
                                            <div class="col">
                                                <label for="dteExpireDate" class="form-label fw-bold">Expire Date : </label>
                                                <input onkeydown="return false" onchange="dateElementValidator(this,'goodReceiveNoteHasItem','expdate')" type="date"
                                                    id="dteExpireDate" required class="form-control" name="dteExpireDate">
                                            </div>
                                        </div>
                                        <br>

                                        <!-- Inner Form Button -->
                                        <div class="row mt-1">
                                            <!-- Clear Button -->
                                            <div class="col-3 text-start">
                                                <button type="button" class="custom-btn btn btn-info btn-sm fw-bold"
                                                    onclick="clearGrnInnerForm()">
                                                    <i class="fa-solid fa-recycle fa-sm"></i> Clear
                                                </button>
                                            </div>

                                            <!-- Action Buttons -->
                                            <div class="col-9 text-end">
                                                <!-- Update Button -->
                                                <button type="submit" id="buttonInnerUpdate"
                                                    class="custom-btn btn btn-warning me-2 fw-bold btn-sm"
                                                    onclick="buttonGrnInnerUpdate(this)">
                                                    <i class="fa-solid fa-edit fa-sm"></i> Update
                                                </button>

                                                <!-- Add Button -->
                                                <button type="button" id="buttonInnerSubmit"
                                                    class="custom-btn btn btn-success fw-bold btn-sm"
                                                    onclick="buttonGrnInnerSubmit(this)">
                                                    <i class="fa-solid fa-plus fa-sm"></i> Add
                                                </button>
                                            </div>
                                        </div> <br>

                                        <!--  Inner Table -->
                                        <div class="row mt-1">
                                            <div class="col-12">
                                                <!-- Table -->
                                                <table class="table table-hover table-striped table-container"
                                                    id="tableGrnItem">
                                                    <thead class="custom-thead fw-bold">
                                                        <tr>
                                                            <!-- Table Headers -->
                                                            <th>#</th>
                                                            <th>Item Name</th>
                                                            <th>Quantity</th>
                                                            <th>Purchase Price (Rs.)</th>
                                                            <th>Line Price (Rs.)</th>
                                                            <th>Modify</th>
                                                        </tr>
                                                    </thead>
                                                    <!-- Table Body: Filled dynamically via JS -->
                                                    <tbody class="custom-tbody fw-bold" id="tableGrnItemBody">
                                                        <!-- Item rows dynamically inserted here -->
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>


                                    </div>
                                </div>
                            </div>
                            <br><br>
                        </div>

                        <!-- ======================= Buttons Row ======================= -->
                        <div class="row mt-4">
                            <div class="col-3 text-start">
                                <button type="button" class="custom-btn btn btn-outline-info btn-sm fw-bold"
                                    onclick="clearGrnForm()">
                                    <i class="fa-solid fa-recycle fa-sm"></i> Clear
                                </button>
                            </div>
                            <div class="col-9 text-end">
                                <button type="submit" id="btnGrnUpdate"
                                    class="custom-btn btn btn-outline-warning me-2 fw-bold btn-sm"
                                    onclick="buttonGrnUpdate(this)">
                                    <i class="fa-solid fa-file-import"></i> Update
                                </button>
                                <button type="submit" id="btnGrnSubmit"
                                    class="custom-btn btn btn-outline-success fw-bold btn-sm"
                                    onclick="buttonGrnSubmit(this)">
                                    <i class="fa-solid fa-paper-plane fa-sm"></i> Submit
                                </button>
                            </div>
                        </div> <br><br>

                    </form>
                </div>
            </div>
        </div>

    </div>
    <!-- End Offcanvas -->



    <!-- Off-Canvas for View Purchase Order Details -->
    <div class="offcanvas offcanvas-end w-50" tabindex="-1" id="offcanvasGrnView" data-bs-backdrop="static"
        data-bs-keyboard="false">
        <div class="offcanvas-header d-flex justify-content-center w-100">
            <h5 class="offcanvas-title text-center flex-grow-1"><i class="fa-solid fa-list-check"></i> View Good Receive Note Details
            </h5>
            <button type="button" class="btn-close position-absolute end-0 me-3" data-bs-dismiss="offcanvas"
                aria-label="Close"></button>
        </div>
        <div class="offcanvas-body">
            <div class="card">
                <div class="card-body">
                    <table class="table table-hover table-container table-bordered" id="tablePurchaseOrderView">

                        <tr>
                            <th>Supplier</th>
                            <td id="tdSupplierName"></td>
                        </tr>

                        <tr>
                            <th>Purchase Order</th>
                            <td id="tdPurchaseOrder"></td>
                        </tr>
                        <tr>
                            <th>Receipt Date</th>
                            <td id="tdReceiptDate"></td>
                        </tr>
                        <tr>
                            <th>Bill No</th>
                            <td id="tdBillNo"></td>
                        </tr>

                        <tr>
                            <th>Total Amount</th>
                            <td id="tdTotalAmount"></td>
                        </tr>
                        <tr>
                            <th>Discount Amount</th>
                            <td id="tdDiscountAmount"></td>
                        </tr>
                        <tr>
                            <th>Net Amount</th>
                            <td id="tdNetAmount"></td>
                        </tr>

                        <tr>
                            <th>Order Status</th>
                            <td id="tdStatus"></td>
                        </tr>

                        <tr>
                            <td colspan="2" class="table-responsive">
                                <table class="table table-hover table-striped table-container" id="printTableGrnItem">
                                    <thead class="custom-thead fw-bold">
                                        <tr>
                                            <!-- Table Headers -->
                                            <th>#</th>
                                            <th>Item Name</th>
                                            <th>Quantity</th>
                                            <th>Purchase Price (Rs.)</th>
                                            <th>Line Price (Rs.)</th>
                                           
                                        </tr>
                                    </thead>
                                    <!-- Table Body: Filled dynamically via JS -->
                                    <tbody class="custom-tbody fw-bold" id="printTableGrnItemBody">
                                        <!-- Item rows dynamically inserted here -->
                                    </tbody>
                                </table>
                            </td>
                        </tr>

                    </table>
                </div>
                <div class="card-footer text-end p-3">
                    <button class="custom-btn btn btn-outline-info btn-sm fw-bold" onclick="buttonPrintRow()">
                        <i class="fa-solid fa-print fa-sm"></i> Print
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="/js/commonTableFunction.js"></script>
    <script src="/js/validationFunction.js"></script>
    <script src="/js/commonFunction.js"></script>
    <script src="/uicontroller/goodreceivenote.js"></script>

</body>

</html>