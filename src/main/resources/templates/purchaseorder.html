<!DOCTYPE html>
<html lang="en">
<!-- Insert CSS and head JS here -->

<head th:replace="~{fragmentlinks :: headResourcesLinks}"></head>

<head>
    <!-- Custom CSS files -->
    <link rel="stylesheet" href="/css/employee.css">
    <link rel="stylesheet" href="/css/dashboard.css">

</head>
<body>

    <!-- Bootstrap Navigation Bar Start-->
    <div th:replace="~{topnavbar :: topNavBarFragment}"></div>
    <!-- Bootstrap Navigation Bar End-->

    <div class="container-fluid">
        <!-- ======================= Page Header Row ======================= -->
        <!-- Row Start: Page Header -->
        <div class="row mt-2">
            <div class="col-12 fw-bold header p-2">
                <h2><i class="fa-solid fa-list-check"></i> Purchase Order Management</h2>
            </div>
        </div><br>
        <!-- Row End: Page Header -->

        <!-- ======================= Add Button Section ======================= -->
        <!-- Row Start: Add New Item Button -->
        <div class="card p-3">
            <!-- Row Start: Button and Tooltip -->
            <div class="row">
                <div class="col-12 text-end">
                    <!-- Triggers the offcanvas form -->
                    <button type="button" class="btn offcanvas-btn fw-bold" data-bs-toggle="offcanvas"
                        data-bs-target="#offcanvasPurchaseOrderForm">
                        <i class="fa-solid fa-plus"></i> ADD A NEW PURCHASE ORDER
                    </button>
                    <small class="text-muted d-block mt-2">Click this to add a new purchase order</small>
                </div>
            </div>
            <!-- Row End: Button and Tooltip -->
        </div>
        <!-- Row End: Add New Item Button -->

        <!-- ======================= Table Display Section ======================= -->
        <!-- Row Start: Data Table -->
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-body">
                        <table class="table table-hover table-striped table-container" id="tablePurchaseOrder">
                            <thead class="custom-thead fw-bold">
                                <tr>
                                    <!-- Table Headers -->
                                    <th>#</th>
                                    <th>Order Code</th>
                                    <th>Supplier Name</th>
                                    <th>Required Date</th>
                                    <th>Total Amount (Rs.)</th>
                                    <th>Status</th>
                                    <th>Modify</th>
                                </tr>
                            </thead>
                            <!-- Table Body: Filled dynamically via JS -->
                            <tbody class="custom-tbody fw-bold" id="tablePurchaseOrderBody">
                                <!-- Item rows dynamically inserted here -->
                            </tbody>
                        </table>
                    </div>

                    <!-- Ingredient Status Icons Explanation (Inside the Card Footer) -->
                    <div class="card-footer text-center">
                        <!-- &nbsp; adds space, | is a separator, and another &nbsp; ensures spacing on both sides -->
                        <i class="fa-solid fa-list-check fa-lg text-warning"></i> <span class="ms-2">Pending</span>
                        &nbsp;
                        <i class="fa-solid fa-list-check fa-lg text-success"></i> <span class="ms-2">Received</span>
                        &nbsp;
                        <i class="fa-solid fa-list-check fa-lg text-danger"></i> <span class="ms-2">Cancelled</span>
                    </div>


                </div>
            </div>
        </div>
        <!-- Row End: Data Table -->

    </div>


    <!-- ======================= Offcanvas Main Form / Inner Form======================= -->
    <div class="offcanvas offcanvas-end" style="width: 100%;" tabindex="-1" id="offcanvasPurchaseOrderForm"
        role="dialog">

        <!-- Bootstrap Navigation Bar Start-->
        <nav th:replace="topnavbar :: topNavBarFragment"></nav>
        <!-- Bootstrap Navigation Bar End-->


        <div class="offcanvas-header">
            <h5 class="offcanvas-title text-center w-100"><i class="fa-solid fa-list-check">
                </i> Purchase Order Details</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>

        <div class="offcanvas-body">
            <div class="card">
                <div class="card-body">
                    <!-- Purchase Order Form -->
                    <form id="formPurchaseOrder" onsubmit="return false">
                        <!-- ======================= Required Note Row ======================= -->
                        <div class="row mt-2">
                            <div class="col-12 fw-bold mt-2">
                                <p class="text-end">Required <span class="text-danger">*</span></p>
                            </div>
                        </div>


                        <div class="row mt-2">
                            <!-- ======================= Main Form ======================= -->
                            <div class="col-5">
                                <!-- Select Supplier -->
                                <div class="row mt-2">
                                    <div class="col-3 fw-bold">
                                        <label for="selectSupplier" class="form-label fw-bold">Supplier : <span
                                                class="text-danger">*</span></label>
                                    </div>
                                    <div class="col-9">
                                        <select name="selectSupplier" required id="selectSupplier" class="form-select"
                                            onchange="selectDynamicElementValidator(this,'purchaseOrder','supplier_id');filterItemsBySupplier();">
                                        </select>
                                    </div>
                                </div>

                                <!-- Select Required Date -->
                                <div class="row mt-2">
                                    <div class="col-3 fw-bold">
                                        <label for="dteRequiredDate" class="form-label">Required <br> Date :
                                            <span class="text-danger">*</span></label>
                                    </div>
                                    <div class="col-9">
                                        <input onkeydown="return false"
                                            onchange="dateElementValidator(this,'purchaseOrder','delivery_date')"
                                            type="date" id="dteRequiredDate" required class="form-control"
                                            name="requiredDate" placeholder="Enter Required Date">
                                    </div>
                                </div>

                                <!-- Enter Total Amount -->
                                <div class="row mt-2">
                                    <div class="col-3 fw-bold">
                                        <label for="textTotalAmount" class="form-label fw-bold">Total <br>
                                            Amount :
                                            <span class="text-danger">*</span></label>
                                    </div>
                                    <div class="col-9">
                                        <input type="text" class="form-control" id="textTotalAmount"
                                            placeholder="Enter Total Amount"
                                            onkeyup="commonTextValidator(this,'^(([1-9][0-9]{0,3})|([1-9][0-9]{0,3}[.]{0,1}[0-9]{2}))$','purchaseOrder','total_amount')"
                                            required>
                                    </div>
                                </div>


                                <!-- Order Status -->
                                <div class="row mt-2">
                                    <div class="col-3 fw-bold">
                                        <label for="selectPurchaseOrderStatus" class="form-label fw-bold">Order
                                            <br>
                                            Status : <span class="text-danger">*</span></label>
                                    </div>
                                    <div class="col-9">
                                        <select name="selectPurchaseOrderStatus" required id="selectPurchaseOrderStatus"
                                            class="form-select"
                                            onchange="selectDynamicElementValidator(this,'purchaseOrder','supplierpurchaseorder_status_id')">
                                        </select>
                                    </div>
                                </div>

                                <!-- Enter Note -->
                                <div class="row mt-2">
                                    <div class="col-3 fw-bold">
                                        <label for="textNote" class="form-label fw-bold">Note :</label>
                                    </div>
                                    <div class="col-9">
                                        <textarea class="form-control" id="textNote" placeholder="Enter Note"
                                            onkeyup="commonTextValidator(this,'^([A-Za-z0-9\/]{1,20}[.]?[\s]?)+$','purchaseOrder','note')"></textarea>
                                    </div>
                                </div>

                            </div>

                            <!-- ======================= Inner Form / Table ================ -->
                            <div class="col-7">
                                <!-- Card Wrapper -->
                                <div class="card shadow-sm">
                                    <div class="card-body">
                                        <h5 class="card-title fw-bold text-center">Purchase Order Item</h5> <br>
                                        <div class="row mt-1">

                                            <!-- Item -->
                                            <div class="col-8">
                                                <label for="selectItem" class="form-label fw-bold">Item : <span
                                                        class="text-danger">*</span></label>
                                                <select name="selectItem" id="selectItem" class="form-select"
                                                    onchange="selectDynamicElementValidator(this,'purchaseOrderHasItem','ingredients_id');checkItemExt();">
                                                </select>
                                            </div>

                                            <!-- Unit Price -->
                                            <div class="col-4">
                                                <label for="textUnitPrice" class="form-label fw-bold">Unit Price
                                                    : <span class="text-danger">*</span></label>
                                                <input type="text" class="form-control" id="textUnitPrice"
                                                    placeholder="Enter Unit Price"
                                                    onkeyup="commonTextValidator(this,'^(([1-9][0-9]{0,10})|([1-9][0-9]{0,10}[.]{0,1}[0-9]{2}))$','purchaseOrderHasItem','unit_price')">
                                            </div>
                                        </div>
                                        <div class="row mt-1">

                                            <!-- Quantity -->
                                            <div class="col-8">
                                                <label for="textQuantity" class="form-label fw-bold">Quantity :
                                                    <span class="text-danger">*</span></label>
                                                <input type="text" class="form-control" id="textQuantity"
                                                    placeholder="Enter Quantity"
                                                    onkeyup="commonTextValidator(this,'^([1-9][0-9]{0,3})$','purchaseOrderHasItem','quantity');calculateLinePrice()">
                                            </div>

                                            <!-- Line Price -->
                                            <div class="col-4">
                                                <label for="textLinePrice" class="form-label fw-bold">Line Price
                                                    : <span class="text-danger">*</span></label>
                                                <input type="text" class="form-control" id="textLinePrice"
                                                    placeholder="Enter Line Price"
                                                    onkeyup="commonTextValidator(this,'^(([1-9][0-9]{0,10})|([1-9][0-9]{0,10}[.]{0,1}[0-9]{2}))$','purchaseOrderHasItem','line_price')">
                                            </div>
                                        </div>
                                        <br>

                                        <!-- Inner Form Button -->
                                        <div class="row mt-1">
                                            <!-- Clear Button -->
                                            <div class="col-3 text-start">
                                                <button type="button" class="custom-btn btn btn-info btn-sm fw-bold"
                                                    onclick="clearPurchaseOrderInnerForm()">
                                                    <i class="fa-solid fa-recycle fa-sm"></i> Clear
                                                </button>
                                            </div>

                                            <!-- Action Buttons -->
                                            <div class="col-9 text-end">
                                                <!-- Update Button -->
                                                <button type="submit" id="buttonInnerUpdate"
                                                    class="custom-btn btn btn-warning me-2 fw-bold btn-sm"
                                                    onclick="buttonPurchaseOrderInnerUpdate(this)">
                                                    <i class="fa-solid fa-edit fa-sm"></i> Update
                                                </button>

                                                <!-- Add Button -->
                                                <button type="button" id="buttonInnerSubmit"
                                                    class="custom-btn btn btn-success fw-bold btn-sm"
                                                    onclick="buttonPurchaseOrderInnerSubmit(this)">
                                                    <i class="fa-solid fa-plus fa-sm"></i> Add
                                                </button>
                                            </div>
                                        </div> <br>

                                        <!--  Inner Table -->
                                        <div class="row mt-1">
                                            <div class="col-12">
                                                <!-- Table -->
                                                <table class="table table-hover table-striped table-container"
                                                    id="tablePurchaseOrderItem">
                                                    <thead class="custom-thead fw-bold">
                                                        <tr>
                                                            <!-- Table Headers -->
                                                            <th>#</th>
                                                            <th>Item Name</th>
                                                            <th>Unit Price (Rs.)</th>
                                                            <th>Quantity</th>
                                                            <th>Line Price (Rs.)</th>
                                                            <th>Modify</th>
                                                        </tr>
                                                    </thead>
                                                    <!-- Table Body: Filled dynamically via JS -->
                                                    <tbody class="custom-tbody fw-bold" id="tablePurchaseOrderItemBody">
                                                        <!-- Item rows dynamically inserted here -->
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>


                                    </div>
                                </div>
                            </div>
                            <br><br>
                        </div>

                        <!-- ======================= Buttons Row ======================= -->
                        <div class="row mt-4">
                            <div class="col-3 text-start">
                                <button type="button" class="custom-btn btn btn-outline-info btn-sm fw-bold"
                                    onclick="clearPurchaseOrderForm()">
                                    <i class="fa-solid fa-recycle fa-sm"></i> Clear
                                </button>
                            </div>
                            <div class="col-9 text-end">
                                <button type="submit" id="btnPurchaseOrderUpdate"
                                    class="custom-btn btn btn-outline-warning me-2 fw-bold btn-sm"
                                    onclick="buttonPurchaseOrderUpdate(this)">
                                    <i class="fa-solid fa-file-import"></i> Update
                                </button>
                                <button type="submit" id="btnPurchaseOrderSubmit"
                                    class="custom-btn btn btn-outline-success fw-bold btn-sm"
                                    onclick="buttonPurchaseOrderSubmit(this)">
                                    <i class="fa-solid fa-paper-plane fa-sm"></i> Submit
                                </button>
                            </div>
                        </div> <br><br>

                    </form>
                </div>
            </div>
        </div>

    </div>
    <!-- End Offcanvas -->



    <!-- Off-Canvas for View Purchase Order Details -->
    <div class="offcanvas offcanvas-end w-50" tabindex="-1" id="offcanvasPurchaseOrderView" data-bs-backdrop="static"
        data-bs-keyboard="false">
        <div class="offcanvas-header d-flex justify-content-center w-100">
            <h5 class="offcanvas-title text-center flex-grow-1"><i class="fa-solid fa-list-check"></i> View Purchase
                Order Details
            </h5>
            <button type="button" class="btn-close position-absolute end-0 me-3" data-bs-dismiss="offcanvas"
                aria-label="Close"></button>
        </div>
        <div class="offcanvas-body">
            <div class="card">
                <div class="card-body">
                    <table class="table table-hover table-container table-bordered" id="tablePurchaseOrderView">

                        <tr>
                            <th>Supplier</th>
                            <td id="tdSupplierName"></td>
                        </tr>

                        <tr>
                            <th>Total Amount</th>
                            <td id="tdTotalAmount"></td>
                        </tr>
                        <tr>
                            <th>Required Date</th>
                            <td id="tdRequiredDate"></td>
                        </tr>

                        <tr>
                            <th>Order Status</th>
                            <td id="tdOrderStatus"></td>
                        </tr>

                        <tr>
                            <td colspan="2" class="table-responsive">
                                <table class="table table-hover table-striped table-container"
                                    id="tablePrintPurchaseOrderItem">
                                    <thead class="custom-thead fw-bold">
                                        <tr>
                                            <!-- Table Headers -->
                                            <th>#</th>
                                            <th>Item Name</th>
                                            <th>Unit Price (Rs.)</th>
                                            <th>Quantity</th>
                                            <th>Line Price (Rs.)</th>
                                        </tr>
                                    </thead>
                                    <!-- Table Body: Filled dynamically via JS -->
                                    <tbody class="custom-tbody fw-bold" id="tablePrintPurchaseOrderItemBody">
                                        <!-- Item rows dynamically inserted here -->
                                    </tbody>
                                </table>
                            </td>
                        </tr>

                    </table>
                </div>
                <div class="card-footer text-end p-3">
                    <button class="custom-btn btn btn-outline-info btn-sm fw-bold" onclick="buttonPrintRow()">
                        <i class="fa-solid fa-print fa-sm"></i> Print
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="/js/commonTableFunction.js"></script>
    <script src="/js/validationFunction.js"></script>
    <script src="/js/commonFunction.js"></script>
    <script src="/uicontroller/purchaseorder.js"></script>

</body>

</html>